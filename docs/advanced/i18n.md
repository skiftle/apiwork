---
order: 4
---

# i18n

Apiwork uses Rails' I18n for translatable strings. Error messages, validation feedback, and other user-facing text can be customized per locale.

Translations are resolved at runtime. The same API definition produces localized responses based on `I18n.locale`.

## Error Codes

Error codes from `respond_with_error` resolve messages through i18n.

### Lookup Order

1. **API-specific** — `apiwork.apis.<path>.error_codes.<code>`
2. **Global** — `apiwork.error_codes.<code>`
3. **Fallback** — Code titleized (`not_found` → "Not Found")

### Global Translations

Override built-in messages for all APIs:

```yaml
# config/locales/en.yml
en:
  apiwork:
    error_codes:
      not_found: "The requested resource could not be found"
      forbidden: "You don't have permission to access this resource"
```

### API-specific Translations

Different APIs can have different messages. For an API mounted at `/api/v1`:

```yaml
# config/locales/en.yml
en:
  apiwork:
    apis:
      api/v1:
        error_codes:
          not_found: "Item not found"
```

The path matches your API's mount path without the leading slash.

### Multiple Languages

```yaml
# config/locales/sv.yml
sv:
  apiwork:
    error_codes:
      bad_request: "Felaktig förfrågan"
      unauthorized: "Autentisering krävs"
      forbidden: "Åtkomst nekad"
      not_found: "Resursen hittades inte"
      conflict: "Konflikt med nuvarande tillstånd"
      unprocessable_entity: "Valideringsfel"
      internal_server_error: "Ett oväntat fel inträffade"
```

### Interpolation

Dynamic values can be inserted into messages:

```yaml
en:
  apiwork:
    error_codes:
      rate_limited: "Too many requests. Try again in %{seconds} seconds."
```

```ruby
respond_with_error :rate_limited, i18n: { seconds: 60 }
```

Response:

```json
{
  "issues": [
    {
      "code": "rate_limited",
      "detail": "Too many requests. Try again in 60 seconds.",
      "path": [],
      "pointer": "",
      "meta": {}
    }
  ]
}
```

### Custom Error Codes

Register custom codes and add translations:

```ruby
# config/initializers/error_codes.rb
Apiwork::ErrorCode.register :insufficient_funds, status: 402
```

```yaml
# config/locales/en.yml
en:
  apiwork:
    error_codes:
      insufficient_funds: "Insufficient funds for this transaction"

# config/locales/sv.yml
sv:
  apiwork:
    error_codes:
      insufficient_funds: "Otillräckligt saldo för denna transaktion"
```

## Action Metadata

Action documentation — summaries, descriptions — can be translated too. This is useful for APIs that serve multiple locales or generate localized OpenAPI specs.

### Where to Define

You have two options:

**In the Contract** (inline):
```ruby
action :index do
  summary "List all invoices"
  description "Returns invoices for the authenticated account"
end
```

**In locale files** (translatable):
```yaml
en:
  apiwork:
    apis:
      api/v1:
        contracts:
          invoice:
            actions:
              index:
                summary: "List all invoices"
                description: "Returns invoices for the authenticated account"
```

### Lookup Order

1. **Inline value** — If the Contract defines `summary` or `description`, that wins
2. **Locale file** — `apiwork.apis.<path>.contracts.<name>.actions.<action>.<field>`
3. **nil** — No text

Inline values are constants. Locale values change with `I18n.locale`.

### Locale File Structure

```yaml
en:
  apiwork:
    apis:
      api/v1:                    # API mount path (without leading /)
        contracts:
          invoice:               # Contract name (without _contract suffix)
            actions:
              index:             # Action name
                summary: "..."
                description: "..."
              create:
                summary: "..."
```

### Multiple Languages

```yaml
# config/locales/api.en.yml
en:
  apiwork:
    apis:
      api/v1:
        contracts:
          invoice:
            actions:
              index:
                summary: "List invoices"
                description: "Returns all invoices for this account"

# config/locales/api.sv.yml
sv:
  apiwork:
    apis:
      api/v1:
        contracts:
          invoice:
            actions:
              index:
                summary: "Lista fakturor"
                description: "Returnerar alla fakturor för detta konto"
```

### When to Use Each Approach

| Approach | Use when |
|----------|----------|
| Inline in Contract | Single language, simple API, developer-facing docs |
| Locale files | Multi-language, user-facing docs, OpenAPI for different markets |

You can mix both — use inline for some actions, locale files for others. Inline always wins when present.

## Type Descriptions

Auto-generated types from `schema!` contracts include translatable descriptions. These appear in OpenAPI schemas, TypeScript JSDoc comments, and other generated documentation.

### Types That Get Descriptions

When using `schema!`, Apiwork generates several types automatically:

| Type | Example | Default Description |
|------|---------|---------------------|
| Filter | `post_filter` | "Filter options for Post" |
| Sort | `post_sort` | "Sort options for Post" |
| Create payload | `post_create_payload` | "Payload for creating a Post" |
| Update payload | `post_update_payload` | "Payload for updating a Post" |

Global types are also translatable:

| Type | Default Description |
|------|---------------------|
| `string_filter` | "String filter operators" |
| `integer_filter` | "Integer filter operators" |
| `page_pagination` | "Page-based pagination info" |
| `cursor_pagination` | "Cursor-based pagination info" |
| `issue` | "Validation issue details" |
| `sort_direction` | "Sort direction (asc/desc)" |

### Lookup Order

1. **API-specific** — `apiwork.apis.<path>.types.<type_name>.description`
2. **Global** — `apiwork.types.<type_kind>.description`
3. **nil** — No description

### Model Names

Descriptions use `%{model_name}` interpolation. The model name comes from `model_class.model_name.human` (ActiveRecord's i18n).

To translate model names, use Rails' standard model translation:

```yaml
en:
  activerecord:
    models:
      invoice: "Invoice"

sv:
  activerecord:
    models:
      invoice: "Faktura"
```

### Global Type Translations

Override default descriptions for all APIs:

```yaml
en:
  apiwork:
    types:
      filter:
        description: "Filter options for %{model_name}"
      sort:
        description: "Sort options for %{model_name}"
      create_payload:
        description: "Payload for creating a %{model_name}"
      update_payload:
        description: "Payload for updating a %{model_name}"
      string_filter:
        description: "String filter operators"
      page_pagination:
        description: "Page-based pagination info"
```

### API-specific Overrides

Different APIs can have different descriptions:

```yaml
en:
  apiwork:
    apis:
      api/v1:
        types:
          invoice_filter:
            description: "Search and filter invoices"
          invoice_create_payload:
            description: "Data for creating a new invoice"
```

### Multiple Languages

```yaml
# config/locales/api.en.yml
en:
  apiwork:
    types:
      filter:
        description: "Filter options for %{model_name}"

# config/locales/api.sv.yml
sv:
  apiwork:
    types:
      filter:
        description: "Filtreringsalternativ för %{model_name}"
```

## Built-in Defaults

Apiwork provides English translations for all 20 built-in error codes and type descriptions. Your app's locale files take precedence — add your own translations to override them.
